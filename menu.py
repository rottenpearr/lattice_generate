#!/usr/bin/env python3
"""
–ú–µ–Ω—é-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –∫—Ä–∏—Å—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏—Ö —Ä–µ—à–µ—Ç–æ–∫
"""

from crystal_generator import CrystalLattice, generate_lattice_parallel, save_xyz
import os


# –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫–∏ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤
def ensure_directories():
    """–°–æ–∑–¥–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–ø–∫–∏ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤"""
    os.makedirs('xyz_files', exist_ok=True)
    os.makedirs('scalability_tests', exist_ok=True)


def print_header():
    """–í—ã–≤–æ–¥–∏—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã"""
    print("\n" + "‚ïî" + "=" * 68 + "‚ïó")
    print("‚ïë" + " " * 26 + "–ì–ï–ù–ï–†–ê–¢–û–† –†–ï–®–ï–¢–û–ö" + " " * 25 + "‚ïë")
    print("‚ïö" + "=" * 68 + "‚ïù\n")


def print_menu():
    """–í—ã–≤–æ–¥–∏—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
    print("\n" + "=" * 70)
    print("–ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ")
    print("=" * 70)
    print("1. –ë—ã—Å—Ç—Ä–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (—Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)")
    print("2. –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (–≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)")
    print("3. –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞—Ç–∞—Å–µ—Ç (–º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ä–µ—à–µ—Ç–æ–∫)")
    print("4. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ—à–µ—Ç–∫–∞—Ö")
    print("5. –¢–µ—Å—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏ (—Å –≥—Ä–∞—Ñ–∏–∫–æ–º)")
    print("0. –í—ã—Ö–æ–¥")
    print("=" * 70)


def quick_generation():
    """–ë—ã—Å—Ç—Ä–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –º–∏–Ω–∏–º—É–º–æ–º –≤–æ–ø—Ä–æ—Å–æ–≤"""
    print("\n" + "=" * 70)
    print("–ë–´–°–¢–†–ê–Ø –ì–ï–ù–ï–†–ê–¶–ò–Ø")
    print("=" * 70)

    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–∏–ø—ã
    popular_types = [
        ('cubic_primitive', '–ö—É–±–∏—á–µ—Å–∫–∞—è –ø—Ä–∏–º–∏—Ç–∏–≤–Ω–∞—è (–ü–ö)'),
        ('cubic_body', '–ö—É–±–∏—á–µ—Å–∫–∞—è –æ–±—ä–µ–º–Ω–æ-—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (–û–¶–ö)'),
        ('cubic_face', '–ö—É–±–∏—á–µ—Å–∫–∞—è –≥—Ä–∞–Ω–µ-—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (–ì–¶–ö)'),
        ('hexagonal', '–ì–µ–∫—Å–∞–≥–æ–Ω–∞–ª—å–Ω–∞—è'),
        ('tetragonal_primitive', '–¢–µ—Ç—Ä–∞–≥–æ–Ω–∞–ª—å–Ω–∞—è –ø—Ä–∏–º–∏—Ç–∏–≤–Ω–∞—è'),
    ]

    print("\n–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–µ—à–µ—Ç–∫–∏:")
    for idx, (key, name) in enumerate(popular_types, 1):
        print(f"{idx}. {name}")

    choice = int(input("\n–í–∞—à –≤—ã–±–æ—Ä (1-5): "))
    lattice_type = popular_types[choice - 1][0]

    # –†–∞–∑–º–µ—Ä
    print("\n–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä:")
    print("1. –ú–∞–ª–∞—è (3√ó3√ó3)")
    print("2. –°—Ä–µ–¥–Ω—è—è (5√ó5√ó5)")
    print("3. –ë–æ–ª—å—à–∞—è (10√ó10√ó10)")
    print("4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è")

    size_choice = int(input("\n–í–∞—à –≤—ã–±–æ—Ä (1-4): "))

    if size_choice == 1:
        nx, ny, nz = 3, 3, 3
    elif size_choice == 2:
        nx, ny, nz = 5, 5, 5
    elif size_choice == 3:
        nx, ny, nz = 10, 10, 10
    else:
        nx = int(input("–†–∞–∑–º–µ—Ä –ø–æ X: "))
        ny = int(input("–†–∞–∑–º–µ—Ä –ø–æ Y: "))
        nz = int(input("–†–∞–∑–º–µ—Ä –ø–æ Z: "))

    # –®—É–º
    add_noise_input = input("\n–î–æ–±–∞–≤–∏—Ç—å —à—É–º? (y/n), –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é n: ").lower()
    add_noise = add_noise_input == 'y'

    # –¢–∏–ø—ã –∏–æ–Ω–æ–≤
    print("\n–¢–∏–ø—ã –∏–æ–Ω–æ–≤:")
    print("1. –û–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç")
    print("2. –ò–æ–Ω–Ω–∞—è —Ä–µ—à–µ—Ç–∫–∞ (–∫–∞—Ç–∏–æ–Ω—ã –∏ –∞–Ω–∏–æ–Ω—ã)")

    ion_choice = input("\n–í—ã–±–æ—Ä (1-2), –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1: ") or "1"

    if ion_choice == '2':
        print("\n–í–≤–µ–¥–∏—Ç–µ –∫–∞—Ç–∏–æ–Ω (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –∏–æ–Ω):")
        cation = input("  –ö–∞—Ç–∏–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, Na, Ca, Li): ")
        print("\n–í–≤–µ–¥–∏—Ç–µ –∞–Ω–∏–æ–Ω (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –∏–æ–Ω):")
        anion = input("  –ê–Ω–∏–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, Cl, O, F): ")

        print("\n–¢–∏–ø —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:")
        print("1. AB (1:1) - –Ω–∞–ø—Ä–∏–º–µ—Ä, NaCl")
        print("2. AB‚ÇÇ (1:2) - –Ω–∞–ø—Ä–∏–º–µ—Ä, CaF‚ÇÇ")

        compound_type = input("\n–í—ã–±–æ—Ä (1-2), –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1: ") or "1"

        if compound_type == '2':
            ion_types = [cation, anion, anion]
            formula = f"{cation}{anion}2"
        else:
            ion_types = [cation, anion]
            formula = f"{cation}{anion}"
    else:
        element = input("–•–∏–º–∏—á–µ—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é C: ") or "C"
        ion_types = [element]
        formula = element

    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è
    print("\n" + "=" * 70)
    print("–ì–ï–ù–ï–†–ê–¶–ò–Ø...")
    print("=" * 70)

    lattice = CrystalLattice(lattice_type)
    positions = generate_lattice_parallel(lattice, nx, ny, nz, add_noise)

    # –ò–º—è —Ñ–∞–π–ª–∞
    if len(ion_types) > 1:
        filename = f"xyz_files/{lattice_type}_{formula}_{nx}x{ny}x{nz}.xyz"
    else:
        filename = f"xyz_files/{lattice_type}_{nx}x{ny}x{nz}.xyz"

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    if len(ion_types) == 1:
        save_xyz(filename, positions, ion_types[0])
    else:
        from crystal_generator import save_ionic_lattice
        save_ionic_lattice(filename, positions, ion_types)

    print(f"\n‚úì –£—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ {len(positions)} –∞—Ç–æ–º–æ–≤")
    print(f"‚úì –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {filename}")


def advanced_generation():
    """–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ –≤—Å–µ–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏"""
    print("\n" + "=" * 70)
    print("–†–ê–°–®–ò–†–ï–ù–ù–ê–Ø –ì–ï–ù–ï–†–ê–¶–ò–Ø")
    print("=" * 70)

    # –í—ã–±–æ—Ä —Ç–∏–ø–∞ —Ä–µ—à–µ—Ç–∫–∏
    print("\n–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∏–ø—ã —Ä–µ—à–µ—Ç–æ–∫:")
    lattice_list = list(CrystalLattice.LATTICE_TYPES.items())

    # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Å–∏–Ω–≥–æ–Ω–∏—è–º
    by_syngony = {}
    for key, info in lattice_list:
        syngony = info['syngony']
        if syngony not in by_syngony:
            by_syngony[syngony] = []
        by_syngony[syngony].append((key, info))

    idx = 1
    choice_map = {}

    for syngony in ['cubic', 'tetragonal', 'orthorhombic', 'hexagonal',
                    'trigonal', 'monoclinic', 'triclinic']:
        if syngony in by_syngony:
            print(f"\n{syngony.upper()}:")
            for key, info in by_syngony[syngony]:
                print(f"  {idx}. {info['name']}")
                choice_map[idx] = key
                idx += 1

    choice = int(input(f"\n–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–µ—à–µ—Ç–∫–∏ (1-{len(choice_map)}): "))
    lattice_type = choice_map[choice]

    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–µ—à–µ—Ç–∫–∏
    print("\n–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–µ—à–µ—Ç–∫–∏:")
    info = CrystalLattice.LATTICE_TYPES[lattice_type]
    print(f"–°–∏–Ω–≥–æ–Ω–∏—è: {info['syngony']}")
    print(f"–¢–∏–ø —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è: {info['centering']}")
    print()

    use_default = input("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é? (y/n), –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é y: ").lower()

    if use_default != 'n':
        a, b, c = 5.0, 5.0, 5.0
        alpha, beta, gamma = 90.0, 90.0, 90.0
    else:
        a = float(input("–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è a (√Ö): "))
        b = float(input("–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è b (√Ö): "))
        c = float(input("–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è c (√Ö): "))
        alpha = float(input("–£–≥–æ–ª Œ± (–≥—Ä–∞–¥—É—Å—ã): "))
        beta = float(input("–£–≥–æ–ª Œ≤ (–≥—Ä–∞–¥—É—Å—ã): "))
        gamma = float(input("–£–≥–æ–ª Œ≥ (–≥—Ä–∞–¥—É—Å—ã): "))

    # –†–∞–∑–º–µ—Ä—ã
    print("\n–†–∞–∑–º–µ—Ä—ã —Ä–µ—à–µ—Ç–∫–∏:")
    nx = int(input("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–æ–Ω–æ–≤ –ø–æ X: "))
    ny = int(input("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–æ–Ω–æ–≤ –ø–æ Y: "))
    nz = int(input("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–æ–Ω–æ–≤ –ø–æ Z: "))

    # –®—É–º
    add_noise_input = input("\n–î–æ–±–∞–≤–∏—Ç—å —à—É–º? (y/n), –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é n: ").lower()
    add_noise = add_noise_input == 'y'
    noise_level = 0.05

    if add_noise:
        noise_level = float(input("–£—Ä–æ–≤–µ–Ω—å —à—É–º–∞, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.05: ") or "0.05")

    # –≠–ª–µ–º–µ–Ω—Ç
    element = input("\n–•–∏–º–∏—á–µ—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é C: ") or "C"

    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è
    print("\n" + "=" * 70)
    print("–ì–ï–ù–ï–†–ê–¶–ò–Ø...")
    print("=" * 70)

    lattice = CrystalLattice(lattice_type, a, b, c, alpha, beta, gamma)

    print(f"\n–¢–∏–ø: {info['name']}")
    print(f"–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: a={lattice.a:.3f}, b={lattice.b:.3f}, c={lattice.c:.3f}")
    print(f"–£–≥–ª—ã: Œ±={lattice.alpha:.1f}¬∞, Œ≤={lattice.beta:.1f}¬∞, Œ≥={lattice.gamma:.1f}¬∞")
    print(f"–†–∞–∑–º–µ—Ä—ã: {nx} √ó {ny} √ó {nz}")

    positions = generate_lattice_parallel(lattice, nx, ny, nz, add_noise, noise_level)

    filename = f"xyz_files/{lattice_type}_{nx}x{ny}x{nz}.xyz"
    save_xyz(filename, positions, element)

    print(f"\n‚úì –£—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ {len(positions)} –∞—Ç–æ–º–æ–≤")
    print(f"‚úì –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {filename}")


def show_info():
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ—à–µ—Ç–∫–∞—Ö"""
    print("\n" + "=" * 70)
    print("–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –†–ï–®–ï–¢–ö–ê–• –ë–†–ê–í–ï")
    print("=" * 70)

    print("\n14 —Ä–µ—à–µ—Ç–æ–∫ –ë—Ä–∞–≤–µ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è –ø–æ 7 —Å–∏–Ω–≥–æ–Ω–∏—è–º:\n")

    info_data = {
        '–ö—É–±–∏—á–µ—Å–∫–∞—è': {
            '–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è': 'a = b = c, Œ± = Œ≤ = Œ≥ = 90¬∞',
            '—Ç–∏–ø—ã': ['–ü—Ä–∏–º–∏—Ç–∏–≤–Ω–∞—è (P)', '–û–±—ä–µ–º–Ω–æ-—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (I)', '–ì—Ä–∞–Ω–µ-—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (F)'],
            '–ø—Ä–∏–º–µ—Ä—ã': 'Po, Fe, Al, Cu, Au'
        },
        '–¢–µ—Ç—Ä–∞–≥–æ–Ω–∞–ª—å–Ω–∞—è': {
            '–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è': 'a = b ‚â† c, Œ± = Œ≤ = Œ≥ = 90¬∞',
            '—Ç–∏–ø—ã': ['–ü—Ä–∏–º–∏—Ç–∏–≤–Ω–∞—è (P)', '–û–±—ä–µ–º–Ω–æ-—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (I)'],
            '–ø—Ä–∏–º–µ—Ä—ã': 'Œ≤-Sn, TiO‚ÇÇ'
        },
        '–†–æ–º–±–∏—á–µ—Å–∫–∞—è': {
            '–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è': 'a ‚â† b ‚â† c, Œ± = Œ≤ = Œ≥ = 90¬∞',
            '—Ç–∏–ø—ã': ['–ü—Ä–∏–º–∏—Ç–∏–≤–Ω–∞—è (P)', '–ë–∞–∑–æ-—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (C)',
                     '–û–±—ä–µ–º–Ω–æ-—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (I)', '–ì—Ä–∞–Ω–µ-—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (F)'],
            '–ø—Ä–∏–º–µ—Ä—ã': 'Œ±-S, I‚ÇÇ, U'
        },
        '–ì–µ–∫—Å–∞–≥–æ–Ω–∞–ª—å–Ω–∞—è': {
            '–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è': 'a = b ‚â† c, Œ± = Œ≤ = 90¬∞, Œ≥ = 120¬∞',
            '—Ç–∏–ø—ã': ['–ü—Ä–∏–º–∏—Ç–∏–≤–Ω–∞—è (P)'],
            '–ø—Ä–∏–º–µ—Ä—ã': 'Mg, Zn, Graphite'
        },
        '–¢—Ä–∏–≥–æ–Ω–∞–ª—å–Ω–∞—è': {
            '–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è': 'a = b = c, Œ± = Œ≤ = Œ≥ ‚â† 90¬∞',
            '—Ç–∏–ø—ã': ['–†–æ–º–±–æ—ç–¥—Ä–∏—á–µ—Å–∫–∞—è (R)'],
            '–ø—Ä–∏–º–µ—Ä—ã': 'As, Sb, Bi, Calcite'
        },
        '–ú–æ–Ω–æ–∫–ª–∏–Ω–Ω–∞—è': {
            '–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è': 'a ‚â† b ‚â† c, Œ± = Œ≥ = 90¬∞, Œ≤ ‚â† 90¬∞',
            '—Ç–∏–ø—ã': ['–ü—Ä–∏–º–∏—Ç–∏–≤–Ω–∞—è (P)', '–ë–∞–∑–æ-—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (C)'],
            '–ø—Ä–∏–º–µ—Ä—ã': 'Œ≤-S, Gypsum'
        },
        '–¢—Ä–∏–∫–ª–∏–Ω–Ω–∞—è': {
            '–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è': 'a ‚â† b ‚â† c, Œ± ‚â† Œ≤ ‚â† Œ≥',
            '—Ç–∏–ø—ã': ['–ü—Ä–∏–º–∏—Ç–∏–≤–Ω–∞—è (P)'],
            '–ø—Ä–∏–º–µ—Ä—ã': 'CuSO‚ÇÑ¬∑5H‚ÇÇO, K‚ÇÇCr‚ÇÇO‚Çá'
        }
    }

    for syngony, data in info_data.items():
        print(f"{syngony}:")
        print(f"  –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: {data['–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è']}")
        print(f"  –¢–∏–ø—ã —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è: {', '.join(data['—Ç–∏–ø—ã'])}")
        print(f"  –ü—Ä–∏–º–µ—Ä—ã: {data['–ø—Ä–∏–º–µ—Ä—ã']}")
        print()

    input("\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...")


def generate_dataset():
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–∞—Ç–∞—Å–µ—Ç –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∫—Ä–∏—Å—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏—Ö —Ä–µ—à–µ—Ç–æ–∫"""
    print("\n" + "=" * 70)
    print("–ì–ï–ù–ï–†–ê–¶–ò–Ø –î–ê–¢–ê–°–ï–¢–ê")
    print("=" * 70)
    print("\n‚ö†Ô∏è  –§—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏!")
    print("\n–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:")
    print("  ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Å–µ—Ö 14 —Ç–∏–ø–æ–≤ —Ä–µ—à–µ—Ç–æ–∫ –ë—Ä–∞–≤–µ")
    print("  ‚Ä¢ –†–∞–∑–ª–∏—á–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã —Ä–µ—à–µ—Ç–æ–∫")
    print("  ‚Ä¢ –í–∞—Ä–∏–∞—Ü–∏–∏ —Å —à—É–º–æ–º –∏ –±–µ–∑")
    print("  ‚Ä¢ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞–ø–∫–∏")
    print("  ‚Ä¢ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (CSV —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏)")
    print("  ‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤")

    input("\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...")


def show_info():
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ—à–µ—Ç–∫–∞—Ö"""
    print("\n" + "=" * 70)
    print("–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –†–ï–®–ï–¢–ö–ê–• –ë–†–ê–í–ï")
    print("=" * 70)

    print("\n14 —Ä–µ—à–µ—Ç–æ–∫ –ë—Ä–∞–≤–µ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è –ø–æ 7 —Å–∏–Ω–≥–æ–Ω–∏—è–º:\n")

    info_data = {
        '–ö—É–±–∏—á–µ—Å–∫–∞—è': {
            '–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è': 'a = b = c, Œ± = Œ≤ = Œ≥ = 90¬∞',
            '—Ç–∏–ø—ã': ['–ü—Ä–∏–º–∏—Ç–∏–≤–Ω–∞—è (P)', '–û–±—ä–µ–º–Ω–æ-—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (I)', '–ì—Ä–∞–Ω–µ-—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (F)'],
            '–ø—Ä–∏–º–µ—Ä—ã': 'Po, Fe, Al, Cu, Au'
        },
        '–¢–µ—Ç—Ä–∞–≥–æ–Ω–∞–ª—å–Ω–∞—è': {
            '–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è': 'a = b ‚â† c, Œ± = Œ≤ = Œ≥ = 90¬∞',
            '—Ç–∏–ø—ã': ['–ü—Ä–∏–º–∏—Ç–∏–≤–Ω–∞—è (P)', '–û–±—ä–µ–º–Ω–æ-—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (I)'],
            '–ø—Ä–∏–º–µ—Ä—ã': 'Œ≤-Sn, TiO‚ÇÇ'
        },
        '–†–æ–º–±–∏—á–µ—Å–∫–∞—è': {
            '–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è': 'a ‚â† b ‚â† c, Œ± = Œ≤ = Œ≥ = 90¬∞',
            '—Ç–∏–ø—ã': ['–ü—Ä–∏–º–∏—Ç–∏–≤–Ω–∞—è (P)', '–ë–∞–∑–æ-—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (C)',
                     '–û–±—ä–µ–º–Ω–æ-—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (I)', '–ì—Ä–∞–Ω–µ-—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (F)'],
            '–ø—Ä–∏–º–µ—Ä—ã': 'Œ±-S, I‚ÇÇ, U'
        },
        '–ì–µ–∫—Å–∞–≥–æ–Ω–∞–ª—å–Ω–∞—è': {
            '–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è': 'a = b ‚â† c, Œ± = Œ≤ = 90¬∞, Œ≥ = 120¬∞',
            '—Ç–∏–ø—ã': ['–ü—Ä–∏–º–∏—Ç–∏–≤–Ω–∞—è (P)'],
            '–ø—Ä–∏–º–µ—Ä—ã': 'Mg, Zn, Graphite'
        },
        '–¢—Ä–∏–≥–æ–Ω–∞–ª—å–Ω–∞—è': {
            '–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è': 'a = b = c, Œ± = Œ≤ = Œ≥ ‚â† 90¬∞',
            '—Ç–∏–ø—ã': ['–†–æ–º–±–æ—ç–¥—Ä–∏—á–µ—Å–∫–∞—è (R)'],
            '–ø—Ä–∏–º–µ—Ä—ã': 'As, Sb, Bi, Calcite'
        },
        '–ú–æ–Ω–æ–∫–ª–∏–Ω–Ω–∞—è': {
            '–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è': 'a ‚â† b ‚â† c, Œ± = Œ≥ = 90¬∞, Œ≤ ‚â† 90¬∞',
            '—Ç–∏–ø—ã': ['–ü—Ä–∏–º–∏—Ç–∏–≤–Ω–∞—è (P)', '–ë–∞–∑–æ-—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è (C)'],
            '–ø—Ä–∏–º–µ—Ä—ã': 'Œ≤-S, Gypsum'
        },
        '–¢—Ä–∏–∫–ª–∏–Ω–Ω–∞—è': {
            '–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è': 'a ‚â† b ‚â† c, Œ± ‚â† Œ≤ ‚â† Œ≥',
            '—Ç–∏–ø—ã': ['–ü—Ä–∏–º–∏—Ç–∏–≤–Ω–∞—è (P)'],
            '–ø—Ä–∏–º–µ—Ä—ã': 'CuSO‚ÇÑ¬∑5H‚ÇÇO, K‚ÇÇCr‚ÇÇO‚Çá'
        }
    }

    for syngony, data in info_data.items():
        print(f"{syngony}:")
        print(f"  –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: {data['–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è']}")
        print(f"  –¢–∏–ø—ã —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è: {', '.join(data['—Ç–∏–ø—ã'])}")
        print(f"  –ü—Ä–∏–º–µ—Ä—ã: {data['–ø—Ä–∏–º–µ—Ä—ã']}")
        print()

    input("\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...")


def run_scalability_test():
    """–ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏ —Å –≥—Ä–∞—Ñ–∏–∫–æ–º"""
    print("\n" + "=" * 70)
    print("–¢–ï–°–¢ –ú–ê–°–®–¢–ê–ë–ò–†–£–ï–ú–û–°–¢–ò")
    print("=" * 70)

    import time
    import numpy as np
    import matplotlib
    matplotlib.use('Agg')
    import matplotlib.pyplot as plt

    total_cpus = os.cpu_count()
    print(f"\n–î–æ—Å—Ç—É–ø–Ω–æ —è–¥–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞: {total_cpus}")

    # –í—ã–±–æ—Ä —Ç–µ—Å—Ç–∞
    print("\n–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ç–µ—Å—Ç–∞:")
    print("1. –ú–∞–ª–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (30√ó30√ó30 —è—á–µ–µ–∫) - —Ç–µ—Å—Ç overhead –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏–∏")
    print("2. –°—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞ (80√ó80√ó80 —è—á–µ–µ–∫) - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å")
    print("3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π")

    test_choice = input("\n–í–∞—à –≤—ã–±–æ—Ä (1-3), –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2: ") or "2"

    if test_choice == '1':
        nx, ny, nz = 30, 30, 30
        n_tests = 3
        test_name = "–ú–∞–ª–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞"
    elif test_choice == '3':
        print("\n–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:")
        nx = int(input("–†–∞–∑–º–µ—Ä –ø–æ X (—è—á–µ–π–∫–∏), –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 80: ") or "80")
        ny = int(input("–†–∞–∑–º–µ—Ä –ø–æ Y (—è—á–µ–π–∫–∏), –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 80: ") or "80")
        nz = int(input("–†–∞–∑–º–µ—Ä –ø–æ Z (—è—á–µ–π–∫–∏), –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 80: ") or "80")
        n_tests = int(input("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤ —Å —Ä–∞–∑–Ω—ã–º —à—É–º–æ–º, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3: ") or "3")
        test_name = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π"
    else:
        nx, ny, nz = 80, 80, 80
        n_tests = 3
        test_name = "–°—Ä–µ–¥–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞"

    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–æ–≤–∏–Ω—É –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —è–¥–µ—Ä
    max_processes = max(1, total_cpus // 2)

    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—Ç–æ–º–æ–≤
    basis_count = 4  # –î–ª—è –ì–¶–ö 4 –∞—Ç–æ–º–∞ –Ω–∞ —è—á–µ–π–∫—É
    total_atoms = nx * ny * nz * basis_count

    print(f"\n–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ—Å—Ç–∞:")
    print(f"  –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: {test_name}")
    print(f"  –¢–∏–ø —Ä–µ—à–µ—Ç–∫–∏: cubic_face (–ì–¶–ö)")
    print(f"  –†–∞–∑–º–µ—Ä: {nx}√ó{ny}√ó{nz} —ç–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω—ã—Ö —è—á–µ–µ–∫")
    print(f"  –ê—Ç–æ–º–æ–≤: {total_atoms:,}")
    print(f"  –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤ (—Å —Ä–∞–∑–Ω—ã–º —à—É–º–æ–º): {n_tests}")
    print(f"  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –ø–æ—Ç–æ–∫–æ–≤: {max_processes} –∏–∑ {total_cpus} –¥–æ—Å—Ç—É–ø–Ω—ã—Ö")
    print("\n–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏...")
    print("(–ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ—à–µ—Ç–∫—É —Å –Ω–æ–≤—ã–º —Å–ª—É—á–∞–π–Ω—ã–º —à—É–º–æ–º)")
    print()

    # –°–æ–∑–¥–∞–µ–º —Ä–µ—à–µ—Ç–∫—É –∑–∞—Ä–∞–Ω–µ–µ (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è)
    lattice = CrystalLattice('cubic_face', 5.0, 5.0, 5.0)

    # –ú–∞—Å—Å–∏–≤—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    num_processes = list(range(1, max_processes + 1))
    time_real = []
    speedup = []
    efficiency = []

    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
    for n_proc in num_processes:
        print(f"  –ü—Ä–æ—Ü–µ—Å—Å–æ–≤: {n_proc}/{max_processes} ... ", end="", flush=True)

        total_time = 0

        # –ü—Ä–æ–≤–æ–¥–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤ —Å —Ä–∞–∑–Ω—ã–º —à—É–º–æ–º
        for test_num in range(n_tests):
            start_time = time.perf_counter()

            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ—à–µ—Ç–∫—É —Å —à—É–º–æ–º (–∫–∞–∂–¥—ã–π —Ä–∞–∑ –Ω–æ–≤—ã–π —à—É–º!)
            positions = generate_lattice_parallel(
                lattice, nx, ny, nz,
                add_noise=True,
                noise_level=0.05,
                n_processes=n_proc
            )

            elapsed = time.perf_counter() - start_time
            total_time += elapsed

        avg_time = total_time / n_tests
        time_real.append(avg_time)

        print(f"–í—Ä–µ–º—è: {avg_time:.3f} —Å–µ–∫")

    # –í—ã—á–∏—Å–ª—è–µ–º –∏–¥–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è (–ª–∏–Ω–µ–π–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ)
    time_ideal = [time_real[0] / i for i in num_processes]

    # –í—ã—á–∏—Å–ª—è–µ–º —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
    speedup = [time_real[0] / t for t in time_real]
    efficiency = [s / n * 100 for s, n in zip(speedup, num_processes)]

    # –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    print("\n" + "=" * 70)
    print("–†–ï–ó–£–õ–¨–¢–ê–¢–´")
    print("=" * 70)
    print(f"\n{'–ü—Ä–æ—Ü–µ—Å—Å–æ–≤':<12} {'–í—Ä–µ–º—è (—Å)':<15} {'–£—Å–∫–æ—Ä–µ–Ω–∏–µ':<15} {'–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å'}")
    print("-" * 70)

    for n, t_real, sp, eff in zip(num_processes, time_real, speedup, efficiency):
        print(f"{n:<12} {t_real:<15.3f} {sp:<15.2f}x {eff:<.1f}%")

    print("\n" + "=" * 70)
    print(f"–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ: {max(speedup):.2f}x –ø—Ä–∏ {num_processes[speedup.index(max(speedup))]} –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö")
    print(f"–°—Ä–µ–¥–Ω—è—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: {np.mean(efficiency):.1f}%")
    print("=" * 70)

    # –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    print("\nüí° –ê–ù–ê–õ–ò–ó –ú–ê–°–®–¢–ê–ë–ò–†–£–ï–ú–û–°–¢–ò:")
    avg_eff = np.mean(efficiency)

    if avg_eff > 80:
        print("  ‚úÖ –û–¢–õ–ò–ß–ù–ê–Ø –ú–ê–°–®–¢–ê–ë–ò–†–£–ï–ú–û–°–¢–¨!")
        print("     –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—á–µ–Ω—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ.")
        print("     –î–∞–ª—å–Ω–µ–π—à–µ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –¥–∞—Å—Ç —Ö–æ—Ä–æ—à–∏–π –ø—Ä–∏—Ä–æ—Å—Ç.")
    elif avg_eff > 60:
        print("  ‚úì –•–û–†–û–®–ê–Ø –ú–ê–°–®–¢–ê–ë–ò–†–£–ï–ú–û–°–¢–¨")
        print("     –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º —Ä–∞–±–æ—Ç–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ.")
        print("     –ú–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.")
    elif avg_eff > 40:
        print("  ‚ö†Ô∏è  –°–†–ï–î–ù–Ø–Ø –ú–ê–°–®–¢–ê–ë–ò–†–£–ï–ú–û–°–¢–¨")
        print("     –ï—Å—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–π overhead –æ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏–∏.")
        print("     –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ä–µ—à–µ—Ç–∫–∏.")
    else:
        print("  ‚ùå –ù–ò–ó–ö–ê–Ø –ú–ê–°–®–¢–ê–ë–ò–†–£–ï–ú–û–°–¢–¨")
        print("     Overhead –æ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏–∏ —Å–ª–∏—à–∫–æ–º –≤–µ–ª–∏–∫.")
        print("     –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:")
        print("     - –£–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ä–µ—à–µ—Ç–∫–∏ (–º–∏–Ω–∏–º—É–º 150√ó150√ó30)")
        print("     - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ–Ω—å—à–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤")

    print()

    # –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ì–†–ê–§–ò–ö–ê –ú–ê–°–®–¢–ê–ë–ò–†–£–ï–ú–û–°–¢–ò
    fig, ax = plt.subplots(figsize=(12, 8))

    # –û—Å–Ω–æ–≤–Ω–æ–π –≥—Ä–∞—Ñ–∏–∫ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏
    ax.plot(num_processes, time_ideal,
            label="–ò–¥–µ–∞–ª—å–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ (—Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π –º–∞–∫—Å–∏–º—É–º)",
            linestyle="--", color="gray", linewidth=2.5, alpha=0.7)
    ax.plot(num_processes, time_real,
            label="–†–µ–∞–ª—å–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ",
            marker="o", color="red", linewidth=2.5, markersize=10)

    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä–∞—Ñ–∏–∫–∞
    ax.set_xlabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤", fontsize=14, fontweight='bold')
    ax.set_ylabel("–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (—Å–µ–∫—É–Ω–¥—ã)", fontsize=14, fontweight='bold')

    # –ó–∞–≥–æ–ª–æ–≤–æ–∫
    title_main = "–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –∫—Ä–∏—Å—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏—Ö —Ä–µ—à–µ—Ç–æ–∫"
    ax.set_title(title_main, fontsize=16, fontweight='bold', pad=15)

    # –ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤–Ω–∏–∑—É –≥—Ä–∞—Ñ–∏–∫–∞
    title_sub = f"{test_name}: {nx}√ó{ny}√ó{nz} —è—á–µ–µ–∫ –ì–¶–ö, {total_atoms:,} –∞—Ç–æ–º–æ–≤ | {n_tests} —Ç–µ—Å—Ç–∞ —Å —à—É–º–æ–º | CPU: {max_processes}/{total_cpus} –ø–æ—Ç–æ–∫–æ–≤"
    fig.text(0.5, 0.02, title_sub, ha='center', fontsize=11,
             bbox=dict(boxstyle='round,pad=0.7', facecolor='lightgray',
                       edgecolor='gray', alpha=0.8))

    # –î–æ–±–∞–≤–ª—è–µ–º –ª–∏–Ω–∏–∏ —Å–µ—Ç–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ—Å–∏
    ax.grid(True, alpha=0.3, linestyle='--', linewidth=0.7)
    ax.set_xticks(num_processes)
    ax.tick_params(axis='both', labelsize=11)

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –æ—Å–µ–π
    ax.set_xlim(0.5, max_processes + 0.5)
    ax.set_ylim(0, max(time_real) * 1.15)

    # –õ–µ–≥–µ–Ω–¥–∞
    ax.legend(fontsize=12, loc='upper right', framealpha=0.9)

    plt.tight_layout(rect=[0, 0.05, 1, 1])  # –û—Å—Ç–∞–≤–ª—è–µ–º –º–µ—Å—Ç–æ –≤–Ω–∏–∑—É –¥–ª—è –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∞

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
    timestamp = time.strftime("%Y%m%d_%H%M%S")
    output_file = f"scalability_tests/test_{timestamp}.png"
    plt.savefig(output_file, dpi=300, bbox_inches='tight')

    print(f"\n‚úì –ì—Ä–∞—Ñ–∏–∫ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω: {output_file}")
    print()

    plt.close()


def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã"""

    # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫–∏ –¥–ª—è —Ñ–∞–π–ª–æ–≤
    ensure_directories()

    while True:
        print_header()
        print_menu()

        try:
            choice = input("\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ: ")

            if choice == '1':
                quick_generation()
            elif choice == '2':
                advanced_generation()
            elif choice == '3':
                generate_dataset()
            elif choice == '4':
                show_info()
            elif choice == '5':
                run_scalability_test()
            elif choice == '0':
                print("\n–î–æ —Å–≤–∏–¥–∞–Ω–∏—è!")
                break
            else:
                print("\n–ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")

            if choice in ['1', '2', '3']:
                input("\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...")

        except KeyboardInterrupt:
            print("\n\n–ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–µ—Ä–≤–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.")
            break
        except Exception as e:
            print(f"\n–û—à–∏–±–∫–∞: {e}")
            input("\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è...")


if __name__ == "__main__":
    main()
